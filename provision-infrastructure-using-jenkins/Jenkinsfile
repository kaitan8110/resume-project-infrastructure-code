pipeline{

    agent any
    environment{
        AWS_ACCESS_KEY_ID=credentials('aws-access-key')
        AWS_SECRET_ACCESS_KEY=credentials('aws-secret-access-key')
        AWS_DEFAULT_REGION="ap-southeast-1"
        SKIP="N"
        TERRADESTROY="N"
        FIRST_DEPLOY="Y"
        STATE_BUCKET="terraform-state-bucket"
        ANSIBLE_BUCKET_NAME="ansible-state-bucket>"
    }

    stages{
        stage("Create Terraform State Buckets"){
            when{
                environment name:'FIRST_DEPLOY',value:'Y'
                environment name:'TERRADESTROY',value:'N'
                environment name:'SKIP',value:'N'
            }
            steps{
                sh'''
                aws s3 mb s3://terraform-state-bucket'''
                
            }
        }
        //new stage from here

    }

    post { 
        always { 
            cleanWs()
        }
    }

}